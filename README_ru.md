# Генератор классов на основе DatabaseMetadata

### Общее описание

Используя DatabaseMetadata для БД можно получить структуру таблиц и т.п. На основе этого можно сгенерировать ряд классов, для обеспечения работы с БД или сопутствующих классов процесса. Например: JPA сущности, репозитории, сервисы, контроллеры и т.п.  

#### В примерах

Генерация основных классов для обеспечения CRUD манипуляцией с сущностями БД на основе мета-данных таблиц БД и/или
дополнительного описания (см https://gitlab.ed-go.xyz/ed-go/backend/services/ms-dict и настройки по умолчанию)

### Пояснения

Генерация происходит по описанным в конфигурации шагам. Каждый шаг может генерировать либо один общий файл для всех таблиц или для каждой таблицы генерируется отдельный файл. 

#### Конфигурация

Глобальные параметры конфигурации:

| Параметр                  | Назначение                                                                                                                                              |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| generator.root            | Путь по умолчанию для генерации получившихся файлов.                                                                                                    |
| generator.export          | Путь XML файла для сохранения структуры (просто для отладки). Если не указан или пустой структура не сохряняется.                                       |
| generator.catalog         | Каталоги в БД для которых генерируется метадата (например для MySQL).                                                                                   |
| generator.schemas         | Схемы в БД для которых генерируется метадата (например для PostgreeSQL).                                                                                |
| generator.schema-packages | Если поределено, то для каждой схемы генерируется свой под-пакет. Параметры внутри <имя схемы>: значение. По умолчанию имя подпакета равно имени схемы. |
| generator.tables.include  | Список таблиц (через запятую), для которых будет генерироваться метадата. Пусто: все.                                                                   |
| generator.tables.exclude  | Список таблиц (через запятую), которые будут исключены из генерации метадаты.                                                                           |
| generator.properties      | Дополнительные параметры, передаваемые во все шаги генерации (<параметр>: <значение>).                                                                  |
| generator.steps           | Секция описания шагов генерации (<шаг>: <конфигурация шага генерации>)                                                                                 |

Для каждой секции применяются следующие параметры (<конфигурация шага генерации>):

| Параметр                               | Тип    | Назначение                                                                                       |
|----------------------------------------|--------|--------------------------------------------------------------------------------------------------|
| generator.steps.<step>.enable          | bool   | Влючение генерации классов соотвествующей секции.                                                |
| generator.steps.<step>.root            | String | Переопределение пути для генерации получившихся файлов.                                          |
| generator.steps.<step>.packages        | String | Название пакета генерируемых классов.                                                            |
| generator.steps.<step>.class-name      | String | (!!!) Если указан, то будет сгенерирован один общий файл для всех обрабатываемых таблиц.         |
| generator.steps.<step>.template        | String | Файл XSLT/Velocity шаблона, используемый для генерации классов.                                  |
| generator.steps.<step>.suffix          | String | Суффикс генерируемых классов.                                                                    |
| generator.steps.<step>.file-name       | String | Строковый шаблон Velocity названия генерации файла (по-умолчанию: \${class\_name}${suffix}.java) |
| generator.steps.<step>.save-part-start | String | Регулярное выражение, для обнаружения существующего дополнительного кода (костыль).               |


#### Пояснения

1. Чтобы лишний раз не перекомпилировать генератор, пути всех шаблонов используют пути OS.
2. Дополнительно, в качестве примера, в проекте есть XML файл **meta-info.xml**, который подключается к шаблонам XSLT и может нести дополнительную мета-информацию для генерации. 

### Компиляция и запуск

Проект построен на Spring Boot 3.0.2 со сброщиком Maven, соответственно скоппилировать и запустить его можно строкой:

**mvn spring-boot:run**

### Дополнения

(опишу позже)